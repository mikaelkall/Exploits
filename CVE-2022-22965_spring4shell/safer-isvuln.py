#!/usr/bin/env python3
#  -*- coding: utf-8 -*-
# Quick hacked script to check if endpoint is vulnerable

__author__ = 'nighter@nighter.se'

import requests
import argparse
from urllib.parse import urlparse
import time
import sys
import os
import time
from urllib.parse import urljoin


def isvuln():
    
    global URL

    session = requests.session()
    _headers = {"User-Agent": "Mozilla/5.0 (X11; Linux x86_64; rv:98.0) Gecko/20100101 Firefox/98.0", "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8", "Accept-Language": "en-US,en;q=0.5", "Accept-Encoding": "gzip, deflate", "Connection": "close", "Upgrade-Insecure-Requests": "1", "Sec-Fetch-Dest": "document", "Sec-Fetch-Mode": "navigate", "Sec-Fetch-Site": "none", "Sec-Fetch-User": "?1", "Content-Type": "application/x-www-form-urlencoded"}
    _data = {"class.module.classLoader.URLs[0]": "0"}
    ret = session.post(URL, headers=_headers, data=_data)
    
    try:
        if str(ret.status_code) == '400':
            print("[+] Vulnerable")
        else:
            print("[-] Not vulnerable") 
    except:
        print("[-] Not vulnerable")


if __name__ == '__main__':
    
    if len(sys.argv) != 2:
        print("Example: %s http://127.0.0.1:8000/spring4shell/greeting" % sys.argv[0])
        print("""Usage: %s <URL>""" % sys.argv[0])
        os._exit(0)
    
    URL = sys.argv[1]    
    isvuln()
